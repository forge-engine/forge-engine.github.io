<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTP Layer API - Forge Kernel Documentation</title>
    <link rel="stylesheet" href="assets/css/forge-docs.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
</head>
<body>
    <div class="docs-container">
        <aside class="sidebar">
            <nav>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-group">
                        <div class="sidebar-nav-group-title">Navigation</div>
                        <ul class="sidebar-nav" style="list-style: none; padding-left: 0;">
                            <li class="sidebar-nav-item">
                                <a href="index.html" class="sidebar-nav-link">Home</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="introduction.html" class="sidebar-nav-link">Introduction</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="getting-started.html" class="sidebar-nav-link">Getting Started</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="core-concepts.html" class="sidebar-nav-link">Core Concepts</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="modules.html" class="sidebar-nav-link">Capabilities</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="api-reference.html" class="sidebar-nav-link">API Reference</a>
                            </li>
                        </ul>
                    </li>
                    <li class="sidebar-nav-group">
                        <div class="sidebar-nav-group-title">API Sections</div>
                        <ul class="sidebar-nav" style="list-style: none; padding-left: 0;">
                            <li class="sidebar-nav-item">
                                <a href="api-core.html" class="sidebar-nav-link">Core Engine</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="api-http.html" class="sidebar-nav-link active">HTTP Layer</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="api-database.html" class="sidebar-nav-link">Database & ORM</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="api-di.html" class="sidebar-nav-link">DI Container</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="api-routing.html" class="sidebar-nav-link">Routing</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="api-modules.html" class="sidebar-nav-link">Module System</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="api-cli.html" class="sidebar-nav-link">CLI & Console</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="api-cache.html" class="sidebar-nav-link">Caching</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="api-validation.html" class="sidebar-nav-link">Validation</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="api-helpers.html" class="sidebar-nav-link">Helpers & Traits</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="api-events.html" class="sidebar-nav-link">Events</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="api-security.html" class="sidebar-nav-link">Security</a>
                            </li>
                        </ul>
                    </li>
                    <li class="sidebar-nav-group">
                        <div class="sidebar-nav-group-title">On This Page</div>
                        <ul class="sidebar-nav" style="list-style: none; padding-left: 0;">
                            <li class="sidebar-nav-item">
                                <a href="#request" class="sidebar-nav-link">Request</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="#response" class="sidebar-nav-link">Response</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="#kernel" class="sidebar-nav-link">Kernel</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="#middleware" class="sidebar-nav-link">Middleware</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="#examples" class="sidebar-nav-link">Usage Examples</a>
                            </li>
                            <li class="sidebar-nav-item">
                                <a href="#best-practices" class="sidebar-nav-link">Best Practices</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </aside>

        <button class="mobile-menu-toggle" aria-label="Toggle menu">â˜°</button>
        <div class="mobile-overlay"></div>

        <main class="main-content">
            <article>
                <header class="docs-header">
                    <h1>HTTP Layer API</h1>
                    <p>Comprehensive HTTP handling including request/response objects, routing, middleware, and kernel processing. These classes provide the foundation for handling web requests and generating responses in your Forge Kernel applications.</p>
                </header>

                <section id="request">
                    <h2>Request</h2>
                    <p>Represents an HTTP request and provides methods to access request data, headers, and other request-related information. This is the primary way to interact with incoming HTTP requests in your application.</p>

                    <h3>Constructor & Properties</h3>
                    <h4>__construct(array $query = [], array $request = [], array $attributes = [], array $cookies = [], array $files = [], array $server = [], string $content = null)</h4>
                    <p>Create a new Request instance with the given parameters.</p>
                    <div class="code-block">
                        <pre><code class="language-php">// Create from globals
$request = Request::createFromGlobals();

// Create manually
$request = new Request(
    $_GET,
    $_POST,
    [],
    $_COOKIE,
    $_FILES,
    $_SERVER,
    file_get_contents('php://input')
);</code></pre>
                    </div>

                    <h3>Request Data Methods</h3>
                    <h4>get(string $key, mixed $default = null): mixed</h4>
                    <p>Get a value from the query string (GET parameters).</p>
                    <div class="code-block">
                        <pre><code class="language-php">$page = $request->get('page', 1);
$search = $request->get('search');</code></pre>
                    </div>

                    <h4>post(string $key, mixed $default = null): mixed</h4>
                    <p>Get a value from the POST parameters.</p>
                    <div class="code-block">
                        <pre><code class="language-php">$username = $request->post('username');
$email = $request->post('email', 'default@example.com');</code></pre>
                    </div>

                    <h4>input(string $key, mixed $default = null): mixed</h4>
                    <p>Get a value from any input source (GET, POST, JSON).</p>
                    <div class="code-block">
                        <pre><code class="language-php">$data = $request->input('user.name');
$settings = $request->input('settings', []);</code></pre>
                    </div>

                    <h4>all(): array</h4>
                    <p>Get all input data as an array.</p>
                    <div class="code-block">
                        <pre><code class="language-php">$allData = $request->all();
$filtered = $request->only(['name', 'email']);
$excluded = $request->except(['password', 'token']);</code></pre>
                    </div>

                    <h3>Request Information Methods</h3>
                    <h4>method(): string</h4>
                    <p>Get the HTTP request method (GET, POST, PUT, DELETE, etc.).</p>
                    <div class="code-block">
                        <pre><code class="language-php">if ($request->method() === 'POST') {
    // Handle POST request
}</code></pre>
                    </div>

                    <h4>isMethod(string $method): bool</h4>
                    <p>Check if the request method matches the given method.</p>
                    <div class="code-block">
                        <pre><code class="language-php">if ($request->isMethod('POST')) {
    // Handle POST request
}</code></pre>
                    </div>

                    <h4>url(): string</h4>
                    <p>Get the full URL of the request.</p>
                    <div class="code-block">
                        <pre><code class="language-php">$currentUrl = $request->url();
$fullUrl = $request->fullUrl(); // Includes query string</code></pre>
                    </div>

                    <h4>path(): string</h4>
                    <p>Get the request path without the domain.</p>
                    <div class="code-block">
                        <pre><code class="language-php">$path = $request->path(); // e.g., /users/123</code></pre>
                    </div>

                    <h3>Header Methods</h3>
                    <h4>header(string $key, string $default = null): string|null</h4>
                    <p>Get a header value by key.</p>
                    <div class="code-block">
                        <pre><code class="language-php">$contentType = $request->header('Content-Type');
$authToken = $request->header('Authorization');</code></pre>
                    </div>

                    <h4>bearerToken(): string|null</h4>
                    <p>Get the bearer token from the Authorization header.</p>
                    <div class="code-block">
                        <pre><code class="language-php">$token = $request->bearerToken();
if ($token) {
    // Validate JWT token
}</code></pre>
                    </div>

                    <h4>accepts(string|array $contentTypes): bool</h4>
                    <p>Check if the request accepts the given content type(s).</p>
                    <div class="code-block">
                        <pre><code class="language-php">if ($request->accepts('application/json')) {
    return response()->json($data);
}</code></pre>
                    </div>
                </section>

                <section id="response">
                    <h2>Response</h2>
                    <p>Represents an HTTP response and provides methods to set response data, headers, and status codes. This class is used to construct and send HTTP responses back to the client.</p>

                    <h3>Constructor & Properties</h3>
                    <h4>__construct(mixed $content = '', int $status = 200, array $headers = [])</h4>
                    <p>Create a new Response instance.</p>
                    <div class="code-block">
                        <pre><code class="language-php">// Basic response
$response = new Response('Hello World', 200, ['Content-Type' => 'text/plain']);

// JSON response
$response = new Response(json_encode($data), 200, ['Content-Type' => 'application/json']);</code></pre>
                    </div>

                    <h3>Response Content Methods</h3>
                    <h4>setContent(mixed $content): self</h4>
                    <p>Set the response content.</p>
                    <div class="code-block">
                        <pre><code class="language-php">$response->setContent('Hello World');
$response->setContent(json_encode($data));</code></pre>
                    </div>

                    <h4>getContent(): string</h4>
                    <p>Get the current response content.</p>
                    <div class="code-block">
                        <pre><code class="language-php">$content = $response->getContent();</code></pre>
                    </div>

                    <h3>Status Code Methods</h3>
                    <h4>setStatusCode(int $code): self</h4>
                    <p>Set the HTTP status code.</p>
                    <div class="code-block">
                        <pre><code class="language-php">$response->setStatusCode(200); // OK
$response->setStatusCode(404); // Not Found
$response->setStatusCode(500); // Internal Server Error</code></pre>
                    </div>

                    <h4>getStatusCode(): int</h4>
                    <p>Get the current status code.</p>
                    <div class="code-block">
                        <pre><code class="language-php">$statusCode = $response->getStatusCode();</code></pre>
                    </div>

                    <h3>Header Methods</h3>
                    <h4>header(string $name, string $value): self</h4>
                    <p>Set a response header.</p>
                    <div class="code-block">
                        <pre><code class="language-php">$response->header('Content-Type', 'application/json');
$response->header('Cache-Control', 'no-cache');
$response->header('X-Custom-Header', 'value');</code></pre>
                    </div>

                    <h4>headers(array $headers): self</h4>
                    <p>Set multiple headers at once.</p>
                    <div class="code-block">
                        <pre><code class="language-php">$response->headers([
    'Content-Type' => 'application/json',
    'Cache-Control' => 'no-cache',
    'X-Rate-Limit' => '100'
]);</code></pre>
                    </div>

                    <h4>getHeaders(): array</h4>
                    <p>Get all response headers.</p>
                    <div class="code-block">
                        <pre><code class="language-php">$headers = $response->getHeaders();
foreach ($headers as $name => $value) {
    echo "$name: $value\n";
}</code></pre>
                    </div>

                    <h3>Response Helpers</h3>
                    <h4>json(mixed $data, int $status = 200): JsonResponse</h4>
                    <p>Create a JSON response.</p>
                    <div class="code-block">
                        <pre><code class="language-php">return response()->json(['message' => 'Success'], 200);
return response()->json($user, 201);</code></pre>
                    </div>

                    <h4>redirect(string $url, int $status = 302): RedirectResponse</h4>
                    <p>Create a redirect response.</p>
                    <div class="code-block">
                        <pre><code class="language-php">return response()->redirect('/dashboard');
return response()->redirect('/login', 301);</code></pre>
                    </div>

                    <h4>download(string $path, string $name = null): BinaryFileResponse</h4>
                    <p>Create a file download response.</p>
                    <div class="code-block">
                        <pre><code class="language-php">return response()->download('/path/to/file.pdf');
return response()->download('/path/to/file.pdf', 'custom-name.pdf');</code></pre>
                    </div>
                </section>

                <section id="kernel">
                    <h2>Kernel</h2>
                    <p>Handles HTTP request processing through middleware pipeline. The Kernel is responsible for processing incoming requests through the middleware stack and generating appropriate responses.</p>

                    <h3>Core Methods</h3>
                    <h4>handle(Request $request): Response</h4>
                    <p>Process a request through the middleware pipeline.</p>
                    <div class="code-block">
                        <pre><code class="language-php">$kernel = new Kernel();
$response = $kernel->handle($request);
$response->send();</code></pre>
                    </div>

                    <h4>pushMiddleware(string $middleware): void</h4>
                    <p>Add middleware to the pipeline.</p>
                    <div class="code-block">
                        <pre><code class="language-php">$kernel->pushMiddleware(AuthenticationMiddleware::class);
$kernel->pushMiddleware(CorsMiddleware::class);
$kernel->pushMiddleware(RateLimitMiddleware::class);</code></pre>
                    </div>

                    <h4>getMiddleware(): array</h4>
                    <p>Get all registered middleware.</p>
                    <div class="code-block">
                        <pre><code class="language-php">$middleware = $kernel->getMiddleware();
foreach ($middleware as $class) {
    echo "Registered: $class\n";
}</code></pre>
                    </div>
                </section>

                <section id="middleware">
                    <h2>Middleware</h2>
                    <p>Interface for creating HTTP middleware. Middleware provides a convenient mechanism for filtering HTTP requests entering your application and processing responses before they're sent to the client.</p>

                    <h3>Interface Definition</h3>
                    <h4>process(Request $request, callable $next): Response</h4>
                    <p>Process an incoming request and return a response.</p>
                    <div class="code-block">
                        <pre><code class="language-php">class AuthenticationMiddleware implements Middleware
{
    public function process(Request $request, callable $next): Response
    {
        // Before request handling
        if (!$this->authenticate($request)) {
            return new Response('Unauthorized', 401);
        }
        
        // Pass to next middleware
        $response = $next($request);
        
        // After request handling
        $response->header('X-Authenticated', 'true');
        
        return $response;
    }
}</code></pre>
                    </div>

                    <h3>Common Middleware Examples</h3>
                    <h4>CORS Middleware</h4>
                    <div class="code-block">
                        <pre><code class="language-php">class CorsMiddleware implements Middleware
{
    public function process(Request $request, callable $next): Response
    {
        $response = $next($request);
        
        $response->headers([
            'Access-Control-Allow-Origin' => '*',
            'Access-Control-Allow-Methods' => 'GET, POST, PUT, DELETE, OPTIONS',
            'Access-Control-Allow-Headers' => 'Content-Type, Authorization'
        ]);
        
        return $response;
    }
}</code></pre>
                    </div>

                    <h4>Rate Limit Middleware</h4>
                    <div class="code-block">
                        <pre><code class="language-php">class RateLimitMiddleware implements Middleware
{
    private $maxRequests = 100;
    private $window = 3600; // 1 hour
    
    public function process(Request $request, callable $next): Response
    {
        $key = 'rate_limit:' . $request->ip();
        $requests = $this->cache->get($key, 0);
        
        if ($requests >= $this->maxRequests) {
            return new Response('Rate limit exceeded', 429);
        }
        
        $this->cache->increment($key);
        $this->cache->expire($key, $this->window);
        
        return $next($request);
    }
}</code></pre>
                    </div>
                </section>

                <section id="examples">
                    <h2>Usage Examples</h2>
                    <p>Common patterns and examples for working with the HTTP Layer classes.</p>

                    <h3>Basic Request Handling</h3>
                    <div class="code-block">
                        <pre><code class="language-php">// Get current request
$request = Request::createFromGlobals();

// Access request data
$username = $request->post('username');
$email = $request->post('email');
$page = $request->get('page', 1);

// Check request method
if ($request->isMethod('POST')) {
    // Handle form submission
    $data = $request->all();
    
    // Validate input
    $validator = new Validator($data, [
        'username' => 'required|min:3',
        'email' => 'required|email'
    ]);
    
    if ($validator->fails()) {
        return response()->json(['errors' => $validator->errors()], 422);
    }
    
    // Process data
    $user = User::create($data);
    
    return response()->json(['user' => $user], 201);
}</code></pre>
                    </div>

                    <h3>JSON API Response</h3>
                    <div class="code-block">
                        <pre><code class="language-php">// Controller method
public function getUser(Request $request, $id)
{
    // Check if request wants JSON
    if (!$request->accepts('application/json')) {
        return response()->setContent('Unsupported format', 406);
    }
    
    // Get user with authentication check
    $user = User::query()->id($id)->first();
    
    if (!$user) {
        return response()->json([
            'error' => 'User not found',
            'code' => 'USER_NOT_FOUND'
        ], 404);
    }
    
    // Check authorization
    if ($user->id !== $request->user()->id) {
        return response()->json([
            'error' => 'Unauthorized',
            'code' => 'UNAUTHORIZED'
        ], 403);
    }
    
    // Return success response
    return response()->json([
        'data' => $user->toArray(),
        'meta' => [
            'timestamp' => now()->toIso8601String(),
            'version' => '1.0'
        ]
    ], 200);
}</code></pre>
                    </div>

                    <h3>File Upload Handling</h3>
                    <div class="code-block">
                        <pre><code class="language-php">public function uploadFile(Request $request)
{
    // Validate file upload
    if (!$request->hasFile('document')) {
        return response()->json(['error' => 'No file uploaded'], 400);
    }
    
    $file = $request->file('document');
    
    // Validate file
    $validator = Validator::make(['file' => $file], [
        'file' => 'required|file|mimes:pdf,doc,docx|max:10240'
    ]);
    
    if ($validator->fails()) {
        return response()->json(['errors' => $validator->errors()], 422);
    }
    
    // Store file
    $path = $file->store('documents', 'local');
    
    // Create file record
    $document = Document::create([
        'name' => $file->getClientOriginalName(),
        'path' => $path,
        'size' => $file->getSize(),
        'mime_type' => $file->getMimeType()
    ]);
    
    return response()->json([
        'message' => 'File uploaded successfully',
        'document' => $document
    ], 201);
}</code></pre>
                    </div>
                </section>

                <section id="best-practices">
                    <h2>Best Practices</h2>
                    <p>Recommended patterns and guidelines for working with the HTTP Layer.</p>

                    <h3>Do's</h3>
                    <ul>
                        <li>Always validate request data before processing</li>
                        <li>Use appropriate HTTP status codes</li>
                        <li>Set proper Content-Type headers</li>
                        <li>Handle file uploads securely</li>
                        <li>Use middleware for cross-cutting concerns</li>
                        <li>Return consistent response formats</li>
                        <li>Handle errors gracefully</li>
                    </ul>

                    <h3>Don'ts</h3>
                    <ul>
                        <li>Don't trust user input without validation</li>
                        <li>Don't expose sensitive information in responses</li>
                        <li>Don't ignore HTTP method semantics</li>
                        <li>Don't bypass middleware for security</li>
                        <li>Don't return generic error messages</li>
                        <li>Don't ignore content negotiation</li>
                        <li>Don't store large files in memory</li>
                    </ul>
                </section>
            </article>
        </main>
    </div>

    <script src="assets/js/docs.js"></script>
</body>
</html>
